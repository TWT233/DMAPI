<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

    <!-- Check OS -->
    <PropertyGroup>
        <OS Condition="$([System.Runtime.InteropServices.RuntimeInformation]::IsOSPlatform($([System.Runtime.InteropServices.OSPlatform]::Windows)))">Windows</OS>
        <OS Condition="$([System.Runtime.InteropServices.RuntimeInformation]::IsOSPlatform($([System.Runtime.InteropServices.OSPlatform]::OSX)))">OSX</OS>
    </PropertyGroup>

    <!-- Find game -->
    <Choose>
        <When Condition="$(OS) == 'OSX'">
            <PropertyGroup>
                <GameDir Condition="!Exists('$(GameDir)')">$(HOME)/Library/Application Support/Steam/steamapps/common/Escape from Duckov</GameDir>
            </PropertyGroup>
        </When>
        <When Condition="$(OS) == 'Windows'">
            <PropertyGroup>
                <!-- registry paths -->
                <GameDir Condition="!Exists('$(GameDir)')">$([MSBuild]::GetRegistryValueFromView('HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\Steam App 3167020', 'InstallLocation', null, RegistryView.Registry64, RegistryView.Registry32))</GameDir>

                <!-- derive from Steam library path -->
                <_SteamLibraryPath>$([MSBuild]::GetRegistryValueFromView('HKEY_CURRENT_USER\SOFTWARE\Valve\Steam', 'SteamPath', null, RegistryView.Registry32))</_SteamLibraryPath>
                <GameDir Condition="!Exists('$(GameDir)') AND '$(_SteamLibraryPath)' != ''">$(_SteamLibraryPath)\steamapps\common\Escape from Duckov</GameDir>
            </PropertyGroup>
        </When>
    </Choose>

    <!-- Derive dll dir -->
    <PropertyGroup>
        <_DllSubPath>\Duckov_Data\Managed</_DllSubPath>
        <_DllSubPath Condition="$(OS) == 'OSX'">/Duckov.app/Contents/Resources/Data/Managed</_DllSubPath>
        <GameDllDir Condition="!Exists('$(GameDllDir)')">$(GameDir)$(_DllSubPath)</GameDllDir>
    </PropertyGroup>
    
    <!-- Derive mod dir -->
    <PropertyGroup>
        <_ModsSubPath>\Duckov_Data\Mods</_ModsSubPath>
        <_ModsSubPath Condition="$(OS) == 'OSX'">/Duckov.app/Contents/Mods</_ModsSubPath>
        <GameModsDir Condition="!Exists('$(GameModsDir)')">$(GameDir)$(_ModsSubPath)</GameModsDir>
    </PropertyGroup>

</Project>
